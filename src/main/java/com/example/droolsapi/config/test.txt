println("=== DEBUG factsDS count ===")
println(factsDS.count())

println("=== DEBUG first few CommonDataModel objects ===")
factsDS.take(10).foreach { m =>
  println(
    s"""
    |INDV_ID            = ${m.getIndv_id()}
    |ELEM_NBR           = ${m.getElem_nbr()}
    |MEM_NAME           = ${m.getMem_name()}
    |CONTINUITY         = ${m.getContinuity()}
    |AGE_IN_DECIMALS    = ${Try(m.getAgeInDecimals()).getOrElse(null)}
    |ADJ_FINAL_DATE     = ${Try(m.getAdjustedFinalDate()).getOrElse(null)}
    |CONTINUOUS_PERIOD  = ${Try(m.getContinuousPeriod()).getOrElse(null)}
    |""".stripMargin
  )
}


println("=== DEBUG distinct keys (safeIndvId) ===")
factsDS
  .map(m => safeIndvId(m))(Encoders.scalaLong)
  .distinct()
  .show(100, truncate=false)
