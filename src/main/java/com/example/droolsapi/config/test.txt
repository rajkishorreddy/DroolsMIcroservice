// group by INDV_ID across the cluster and run fireRulesForIndv per group
val resultsDS = factsDS
  .groupByKey(f => Option(f.getIndv_id).map(_.toLong).getOrElse(-1L))
  .mapGroups { case (indvId, iter) =>
    // iter is all CommonDataModel for this INDV_ID (on that executor)
    val factSeq = iter.toSeq

    // run rules for just this INDV_ID using the SAME helper you already have
    val hits: Seq[(Long, String)] = fireRulesForIndv(kbase, indvId, factSeq)

    // return those hits
    hits
  }
  // mapGroups returns Seq[(Long,String)], so flatten that
  .flatMap(identity)    // Dataset[(Long, String)]

import spark.implicits._
val resultsDF = resultsDS.toDF("INDV_ID", "RULE_STATUS")

resultsDF.show(truncate=false)
